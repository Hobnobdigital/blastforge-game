import{C as u,B as x,S as g,G as D,M as y,a as d,b as X,c as U,d as H,T as L,e as B,P as O,W as R,f as Y,A as z,D as Z}from"./three-CGAK4KoI.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();class _{x;y;type;hasDestructibleWall;hasBomb=!1;powerUp=null;explosionTimer=0;floorMesh=null;wallMesh=null;powerUpMesh=null;constructor(e){this.x=e.x,this.y=e.y,this.type=e.type,this.hasDestructibleWall=e.hasDestructibleWall}isWalkable(){return this.type==="floor"&&!this.hasDestructibleWall&&!this.hasBomb}isExplodable(){return this.type!=="indestructible"}}const v=13,T=13,w=1,N=3,K=2,$=4,C=1,F=.2,k={grasslands:{background:new u(8900331),ambient:new u(16777181),floor:5025616,floorAlt:4431943,walls:13789470,indestructible:6381921},cave:{background:new u(1706542),ambient:new u(13413e3),floor:6111287,floorAlt:5125166,walls:9268835,indestructible:3622735},lava:{background:new u(1703936),ambient:new u(16739125),floor:9109504,floorAlt:8060928,walls:3092271,indestructible:2171169},ice:{background:new u(14743546),ambient:new u(11789820),floor:8508666,floorAlt:5227511,walls:11583173,indestructible:7901340},space:{background:new u(655392),ambient:new u(8146431),floor:1713022,floorAlt:870305,walls:4854924,indestructible:3218322}},P=[{number:1,theme:"grasslands",enemyCount:3,enemyTypes:["balloon"],enemySpeed:1.5,musicTrack:"level-gameplay"},{number:2,theme:"grasslands",enemyCount:4,enemyTypes:["balloon","ghost"],enemySpeed:1.8,musicTrack:"level-gameplay"},{number:3,theme:"cave",enemyCount:5,enemyTypes:["ghost","balloon"],enemySpeed:2,musicTrack:"level-gameplay"},{number:4,theme:"cave",enemyCount:6,enemyTypes:["balloon","ghost","knight"],enemySpeed:2.2,musicTrack:"level-gameplay"},{number:5,theme:"lava",enemyCount:7,enemyTypes:["knight","ghost"],enemySpeed:2.5,musicTrack:"boss-level"},{number:6,theme:"lava",enemyCount:8,enemyTypes:["knight","knight","ghost"],enemySpeed:2.7,musicTrack:"level-gameplay"},{number:7,theme:"ice",enemyCount:8,enemyTypes:["ghost","knight"],enemySpeed:3,musicTrack:"level-gameplay"},{number:8,theme:"ice",enemyCount:9,enemyTypes:["knight","knight","ghost"],enemySpeed:3.2,musicTrack:"boss-level"},{number:9,theme:"space",enemyCount:10,enemyTypes:["knight","ghost","knight"],enemySpeed:3.5,musicTrack:"level-gameplay"},{number:10,theme:"space",enemyCount:12,enemyTypes:["knight","knight","knight"],enemySpeed:4,musicTrack:"boss-level"}],A=new x(w,w,w),Q=new x(w,.1,w),V=new g(.25,8,8),I={bomb:16728193,fire:16750592,speed:58998};class q{WIDTH=v;HEIGHT=T;cells=[];group=new D;theme=k.grasslands;constructor(){this.buildCells()}buildCells(){for(let e=0;e<this.HEIGHT;e++){this.cells[e]=[];for(let s=0;s<this.WIDTH;s++){const t=s===0||e===0||s===this.WIDTH-1||e===this.HEIGHT-1,i=!t&&s%2===0&&e%2===0;this.cells[e][s]=new _({x:s,y:e,type:t||i?"indestructible":"floor",hasDestructibleWall:!t&&!i&&Math.random()>.3})}}this.clearSpawnArea(1,1),this.clearSpawnArea(this.WIDTH-2,1),this.clearSpawnArea(1,this.HEIGHT-2),this.clearSpawnArea(this.WIDTH-2,this.HEIGHT-2)}clearSpawnArea(e,s){for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++){const o=this.getCell(e+i,s+t);o&&o.type!=="indestructible"&&(o.hasDestructibleWall=!1)}}getCell(e,s){return e<0||e>=this.WIDTH||s<0||s>=this.HEIGHT?null:this.cells[s][e]}gridToWorld(e,s){return{x:(e-this.WIDTH/2+.5)*w,z:(s-this.HEIGHT/2+.5)*w}}worldToGrid(e,s){return{x:Math.floor(e/w+this.WIDTH/2),y:Math.floor(s/w+this.HEIGHT/2)}}applyTheme(e){this.theme=k[e]||k.grasslands,this.rebuildMeshes()}rebuildMeshes(){for(;this.group.children.length;){const e=this.group.children[0];this.group.remove(e)}for(let e=0;e<this.HEIGHT;e++)for(let s=0;s<this.WIDTH;s++){const t=this.cells[e][s],i=this.gridToWorld(s,e),o=(s+e)%2===0?this.theme.floor:this.theme.floorAlt,n=new y({color:o}),r=new d(Q,n);if(r.position.set(i.x,-.05,i.z),r.receiveShadow=!0,this.group.add(r),t.floorMesh=r,t.type==="indestructible"){const a=new y({color:this.theme.indestructible}),h=new d(A,a);h.position.set(i.x,.5,i.z),h.castShadow=!0,h.receiveShadow=!0,this.group.add(h),t.wallMesh=h}else if(t.hasDestructibleWall){const a=new y({color:this.theme.walls}),h=new d(A,a);h.position.set(i.x,.5,i.z),h.castShadow=!0,this.group.add(h),t.wallMesh=h}}}destroyWall(e,s){const t=this.getCell(e,s);if(!t||!t.hasDestructibleWall)return null;if(t.hasDestructibleWall=!1,t.wallMesh&&(this.group.remove(t.wallMesh),t.wallMesh=null),Math.random()<F){const i=["bomb","fire","speed"],o=i[Math.floor(Math.random()*i.length)];return t.powerUp=o,this.spawnPowerUpMesh(t),o}return null}spawnPowerUpMesh(e){if(!e.powerUp)return;const s=this.gridToWorld(e.x,e.y),t=new y({color:I[e.powerUp],emissive:I[e.powerUp],emissiveIntensity:.5}),i=new d(V,t);i.position.set(s.x,.3,s.z),this.group.add(i),e.powerUpMesh=i}collectPowerUp(e,s){const t=this.getCell(e,s);if(!t||!t.powerUp)return null;const i=t.powerUp;return t.powerUp=null,t.powerUpMesh&&(this.group.remove(t.powerUpMesh),t.powerUpMesh=null),i}reset(){this.cells=[],this.buildCells()}}class j{gridX;gridY;worldX=0;worldZ=0;speed=$;bombsAvailable=C;maxBombs=C;explosionRange=K;health=3;alive=!0;invincibleTimer=0;mesh;bodyMesh;constructor(e,s,t){this.gridX=e,this.gridY=s;const i=t.gridToWorld(e,s);this.worldX=i.x,this.worldZ=i.z,this.mesh=new D;const o=new X(.25,.3,4,8),n=new y({color:2201331});this.bodyMesh=new d(o,n),this.bodyMesh.position.y=.4,this.bodyMesh.castShadow=!0,this.mesh.add(this.bodyMesh);const r=new g(.06,6,6),a=new y({color:16777215}),h=new d(r,a);h.position.set(-.1,.55,.2),this.mesh.add(h);const m=new d(r,a);m.position.set(.1,.55,.2),this.mesh.add(m),this.mesh.position.set(this.worldX,0,this.worldZ)}update(e,s,t){if(!this.alive)return;this.invincibleTimer>0?(this.invincibleTimer-=e,this.mesh.visible=Math.floor(this.invincibleTimer*10)%2===0):this.mesh.visible=!0;const i=t.getDirection();if(i.x!==0||i.y!==0){const r=Math.sqrt(i.x*i.x+i.y*i.y),a=i.x/r,h=i.y/r,m=this.worldX+a*this.speed*e,c=this.worldZ+h*this.speed*e,l=.35,M=this.canMove(m,this.worldZ,l,s),f=this.canMove(this.worldX,c,l,s);M&&(this.worldX=m),f&&(this.worldZ=c),(i.x!==0||i.y!==0)&&(this.mesh.rotation.y=Math.atan2(i.x,i.y))}this.mesh.position.set(this.worldX,0,this.worldZ);const o=s.worldToGrid(this.worldX,this.worldZ);this.gridX=o.x,this.gridY=o.y;const n=s.collectPowerUp(this.gridX,this.gridY);n&&this.applyPowerUp(n)}canMove(e,s,t,i){const o=[{x:e-t,z:s-t},{x:e+t,z:s-t},{x:e-t,z:s+t},{x:e+t,z:s+t}];for(const n of o){const r=i.worldToGrid(n.x,n.z),a=i.getCell(r.x,r.y);if(!a||!a.isWalkable())return!1}return!0}applyPowerUp(e){switch(e){case"bomb":this.maxBombs++,this.bombsAvailable++;break;case"fire":this.explosionRange++;break;case"speed":this.speed+=.5;break}}takeDamage(){this.invincibleTimer>0||(this.health--,this.health<=0?(this.alive=!1,this.mesh.visible=!1):this.invincibleTimer=2)}returnBomb(){this.bombsAvailable=Math.min(this.bombsAvailable+1,this.maxBombs)}}const J={balloon:16739179,onion:16754470,tiger:16763432},ee={balloon:{speedMultiplier:.8,changeDirTime:2,seesBombs:!1,seeksPowerUps:!1,pathfinds:!1},onion:{speedMultiplier:1.2,changeDirTime:1.5,seesBombs:!1,seeksPowerUps:!1,pathfinds:!0},tiger:{speedMultiplier:1.5,changeDirTime:1,seesBombs:!0,seeksPowerUps:!0,pathfinds:!0}};class se{type;gridX;gridY;worldX=0;worldZ=0;speed;alive=!0;mesh;direction={x:0,y:0};changeDirTimer=0;aiSettings;bodyMesh;eyeLeft;eyeRight;animOffset=Math.random()*100;constructor(e,s){this.type=e.type,this.gridX=e.gridX,this.gridY=e.gridY,this.aiSettings=ee[e.type],this.speed=e.speed*this.aiSettings.speedMultiplier;const t=s.gridToWorld(this.gridX,this.gridY);this.worldX=t.x,this.worldZ=t.z,this.mesh=new D,this.createVisuals(),this.mesh.position.set(this.worldX,0,this.worldZ),this.pickNewDirection(s)}createVisuals(){const e=J[this.type];if(this.type==="balloon"){const a=new g(.3,16,16),h=new y({color:e});this.bodyMesh=new d(a,h),this.bodyMesh.position.y=.35,this.bodyMesh.castShadow=!0,this.mesh.add(this.bodyMesh);const m=new U(.02,.02,.2),c=new y({color:16777215}),l=new d(m,c);l.position.y=.1,this.mesh.add(l)}else if(this.type==="onion"){const a=new H(.3,.6,16),h=new y({color:e});this.bodyMesh=new d(a,h),this.bodyMesh.position.y=.4,this.bodyMesh.castShadow=!0,this.mesh.add(this.bodyMesh);const m=new L(.25,.03,8,16),c=new y({color:16777215}),l=new d(m,c);l.rotation.x=Math.PI/2,l.position.y=.4,this.mesh.add(l)}else{const a=new x(.4,.5,.6),h=new y({color:e});this.bodyMesh=new d(a,h),this.bodyMesh.position.y=.35,this.bodyMesh.castShadow=!0,this.mesh.add(this.bodyMesh);const m=new x(.42,.1,.4),c=new y({color:0}),l=new d(m,c);l.position.y=.45,this.mesh.add(l)}const s=new g(.06,8,8),t=new y({color:16777215}),i=new g(.03,8,8),o=new y({color:0});this.eyeLeft=new d(s,t),this.eyeLeft.position.set(-.1,.55,.2),this.mesh.add(this.eyeLeft),this.eyeRight=new d(s,t),this.eyeRight.position.set(.1,.55,.2),this.mesh.add(this.eyeRight);const n=new d(i,o);n.position.z=.05,this.eyeLeft.add(n);const r=new d(i,o);r.position.z=.05,this.eyeRight.add(r)}update(e,s,t,i,o){if(!this.alive)return;this.changeDirTimer-=e,this.animate(e),this.aiSettings.pathfinds&&this.changeDirTimer<=0?this.type==="tiger"?this.updateTigerAI(s,t,i,o):this.type==="onion"&&this.updateOnionAI(s,t,i):this.type==="balloon"&&this.changeDirTimer<=0&&this.updateBalloonAI(s),this.tryMove(e,s,o);const n=s.worldToGrid(this.worldX,this.worldZ);this.gridX=n.x,this.gridY=n.y}animate(e){this.animOffset+=e*5,this.type==="balloon"?(this.mesh.position.y=Math.abs(Math.sin(this.animOffset))*.1,this.mesh.scale.y=1+Math.sin(this.animOffset*2)*.05):this.type==="onion"?this.mesh.rotation.z=Math.sin(this.animOffset)*.05:this.bodyMesh.position.y=.35+Math.abs(Math.sin(this.animOffset*1.5))*.05,this.mesh.position.x=this.worldX,this.mesh.position.z=this.worldZ}updateBalloonAI(e){this.pickNewDirection(e),this.changeDirTimer=this.aiSettings.changeDirTime}updateOnionAI(e,s,t){const i=s-this.gridX,o=t-this.gridY,n=[];Math.abs(i)>Math.abs(o)?(n.push({x:Math.sign(i),y:0}),n.push({x:0,y:Math.sign(o)})):(n.push({x:0,y:Math.sign(o)}),n.push({x:Math.sign(i),y:0})),n.push({x:-n[0].y,y:n[0].x}),n.push({x:n[0].y,y:-n[0].x});for(const r of n)if(this.canMoveInDirection(r,e)){this.direction=r;break}this.changeDirTimer=this.aiSettings.changeDirTime}updateTigerAI(e,s,t,i){let o=null,n=1/0;for(let c=0;c<e.HEIGHT;c++)for(let l=0;l<e.WIDTH;l++)if(e.getCell(l,c)?.powerUp){const f=Math.abs(l-this.gridX)+Math.abs(c-this.gridY);f<n&&(n=f,o={x:l,y:c})}let r=s,a=t;this.aiSettings.seeksPowerUps&&o&&n<5&&(r=o.x,a=o.y);const h=[],m=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];for(const c of m)if(this.canMoveInDirection(c,e)){const l=this.gridX+c.x,M=this.gridY+c.y;let f=0;const W=Math.abs(l-r)+Math.abs(M-a);if(f-=W,this.aiSettings.seesBombs)for(const E of i){const S=Math.abs(l-E.x)+Math.abs(M-E.y);S<=2&&(f-=(3-S)*10)}h.push({...c,score:f})}h.length>0&&(h.sort((c,l)=>l.score-c.score),this.direction={x:h[0].x,y:h[0].y}),this.changeDirTimer=this.aiSettings.changeDirTime}tryMove(e,s,t){const o=this.speed*e,n=this.worldX+this.direction.x*o,r=this.worldZ+this.direction.y*o,a=this.direction.x!==0&&this.canMove(n,this.worldZ,.25,s,t),h=this.direction.y!==0&&this.canMove(this.worldX,r,.25,s,t);a&&(this.worldX=n),h&&(this.worldZ=r),(this.direction.x!==0||this.direction.y!==0)&&(this.mesh.rotation.y=Math.atan2(this.direction.x,this.direction.y)),!a&&!h&&this.changeDirTimer<=0&&(this.pickNewDirection(s),this.changeDirTimer=.5)}canMove(e,s,t,i,o=[]){const n=[{x:e-t,z:s-t},{x:e+t,z:s-t},{x:e-t,z:s+t},{x:e+t,z:s+t}];for(const r of n){const a=i.worldToGrid(r.x,r.z),h=i.getCell(a.x,a.y);if(!h||!h.isWalkable())return!1;if(this.aiSettings.seesBombs){for(const m of o)if(a.x===m.x&&a.y===m.y)return!1}}return!0}canMoveInDirection(e,s){const t=this.gridX+e.x,i=this.gridY+e.y,o=s.getCell(t,i);return o!==null&&o.isWalkable()}pickNewDirection(e){const t=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}].filter(i=>this.canMoveInDirection(i,e));if(t.length>0){const i=t.filter(o=>!(o.x===-this.direction.x&&o.y===-this.direction.y));i.length>0?this.direction=i[Math.floor(Math.random()*i.length)]:this.direction=t[Math.floor(Math.random()*t.length)]}}takeDamage(){this.alive&&(this.alive=!1,this.mesh.scale.set(1.2,.2,1.2))}die(){this.alive=!1,this.mesh.visible=!1}getDropPowerUp(){if(Math.random()<.15){const e=["bomb","fire","speed"];return e[Math.floor(Math.random()*e.length)]}return null}}class te{grid;scene;enemies=[];spawnQueue=[];spawnTimer=0;spawnInterval=1;powerUpDrops=[];constructor(e,s){this.grid=e,this.scene=s}spawnEnemiesAtPositions(e,s){for(const t of e)this.spawnQueue.push({type:t.type,gridX:t.x,gridY:t.y,speed:s})}spawnEnemy(e){const s=this.grid.getCell(e.gridX,e.gridY);if(!s||!s.isWalkable())return console.warn(`Cannot spawn enemy at (${e.gridX}, ${e.gridY}): cell not walkable`),null;if(this.isPositionOccupied(e.gridX,e.gridY))return console.warn(`Cannot spawn enemy at (${e.gridX}, ${e.gridY}): position occupied`),null;const t=new se(e,this.grid);return this.enemies.push(t),this.scene.add(t.mesh),console.log(`Spawned ${e.type} enemy at (${e.gridX}, ${e.gridY})`),t}spawnRandomEnemies(e,s,t){const i=[];for(let o=2;o<this.grid.HEIGHT-2;o++)for(let n=2;n<this.grid.WIDTH-2;n++){const r=this.grid.getCell(n,o);r&&r.isWalkable()&&!this.isNearPlayerSpawn(n,o)&&i.push({x:n,y:o})}for(let o=i.length-1;o>0;o--){const n=Math.floor(Math.random()*(o+1));[i[o],i[n]]=[i[n],i[o]]}for(let o=0;o<Math.min(e,i.length);o++){const n=i[o],r=s[Math.floor(Math.random()*s.length)];this.spawnQueue.push({type:r,gridX:n.x,gridY:n.y,speed:t})}}isNearPlayerSpawn(e,s){const t=[{x:1,y:1},{x:this.grid.WIDTH-2,y:1},{x:1,y:this.grid.HEIGHT-2},{x:this.grid.WIDTH-2,y:this.grid.HEIGHT-2}];for(const i of t)if(Math.abs(e-i.x)+Math.abs(s-i.y)<=3)return!0;return!1}isPositionOccupied(e,s){return this.enemies.some(t=>t.alive&&t.gridX===e&&t.gridY===s)}update(e,s,t,i){if(this.spawnQueue.length>0&&(this.spawnTimer-=e,this.spawnTimer<=0)){const o=this.spawnQueue.shift();this.spawnEnemy(o),this.spawnTimer=this.spawnInterval}for(const o of this.enemies)o.alive&&o.update(e,this.grid,s,t,i);this.processDeaths()}processDeaths(){for(const e of this.enemies)if(!e.alive&&e.mesh.visible){e.die();const s=e.getDropPowerUp();s&&this.powerUpDrops.push({x:e.gridX,y:e.gridY,type:s}),this.scene.remove(e.mesh)}}checkExplosionHit(e,s){let t=!1;for(const i of this.enemies)i.alive&&i.gridX===e&&i.gridY===s&&(i.takeDamage(),t=!0);return t}getEnemies(){return this.enemies.filter(e=>e.alive)}getAliveCount(){return this.enemies.filter(e=>e.alive).length}consumePowerUpDrops(){const e=[...this.powerUpDrops];return this.powerUpDrops=[],e}reset(){for(const e of this.enemies)this.scene.remove(e.mesh);this.enemies=[],this.spawnQueue=[],this.powerUpDrops=[],this.spawnTimer=0}areAllDefeated(){return this.enemies.length>0&&this.enemies.every(e=>!e.alive)}}var b=(p=>(p[p.None=0]="None",p[p.Up=1]="Up",p[p.Down=2]="Down",p[p.Left=3]="Left",p[p.Right=4]="Right",p))(b||{});class ie{keys=new Set;bombPressed=!1;pausePressed=!1;anyKeyPressed=!1;pauseCallback=null;constructor(){window.addEventListener("keydown",e=>{this.keys.add(e.code),e.code==="Space"&&(this.bombPressed=!0),(e.code==="Escape"||e.code==="KeyP")&&(this.pausePressed=!0,this.pauseCallback?.()),this.anyKeyPressed=!0,e.preventDefault()}),window.addEventListener("keyup",e=>{this.keys.delete(e.code)})}setPauseCallback(e){this.pauseCallback=e}poll(){const e=this.getDirection();let s=b.None;return e.x<0?s=b.Left:e.x>0?s=b.Right:e.y<0?s=b.Up:e.y>0&&(s=b.Down),{moveDir:s,placeBomb:this.consumeBomb(),fuseAction:null,pause:this.consumePause(),menuBack:this.keys.has("Escape"),menuSelect:this.keys.has("Enter")||this.keys.has("Space"),menuUp:this.keys.has("ArrowUp")||this.keys.has("KeyW"),menuDown:this.keys.has("ArrowDown")||this.keys.has("KeyS"),menuLeft:this.keys.has("ArrowLeft")||this.keys.has("KeyA"),menuRight:this.keys.has("ArrowRight")||this.keys.has("KeyD")}}getDirection(){let e=0,s=0;return(this.keys.has("ArrowLeft")||this.keys.has("KeyA"))&&(e-=1),(this.keys.has("ArrowRight")||this.keys.has("KeyD"))&&(e+=1),(this.keys.has("ArrowUp")||this.keys.has("KeyW"))&&(s-=1),(this.keys.has("ArrowDown")||this.keys.has("KeyS"))&&(s+=1),{x:e,y:s}}consumeBomb(){return this.bombPressed?(this.bombPressed=!1,!0):!1}consumePause(){return this.pausePressed?(this.pausePressed=!1,!0):!1}consumeAnyKey(){return this.anyKeyPressed?(this.anyKeyPressed=!1,!0):!1}}class G{scene;camera;renderer;animationId=null;grid;player;input;enemySpawner;bombs=[];explosions=[];activeBombPositions=[];lastTime=0;levelComplete=!1;gameOver=!1;bombGeo;bombMat;explosionGeo;explosionMat;constructor(){this.scene=new B,this.scene.background=new u(8900331),this.camera=new O(45,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,15,15),this.camera.lookAt(0,0,0),this.renderer=new R({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0;const e=document.getElementById("app");e&&(e.innerHTML="",e.appendChild(this.renderer.domElement)),this.setupLighting(),this.bombGeo=new g(.3,16,16),this.bombMat=new y({color:2171169}),this.explosionGeo=new x(.9,.1,.9),this.explosionMat=new Y({color:16733986}),this.input=new ie,this.grid=new q,this.scene.add(this.grid.group),this.player=new j(1,1,this.grid),this.scene.add(this.player.mesh),this.enemySpawner=new te(this.grid,this.scene),this.spawnLevelEnemies(1),window.addEventListener("resize",this.onWindowResize.bind(this)),this.lastTime=performance.now(),this.animate(),console.log("ðŸŽ® BlastZone3D initialized"),console.log("ðŸ‘¾ Enemy AI System active"),console.log("   - Balloon: Random movement"),console.log("   - Onion: Pathfinding toward player"),console.log("   - Tiger: Advanced AI with bomb avoidance")}setupLighting(){const e=new z(16777215,.5);this.scene.add(e);const s=new Z(16777215,.8);s.position.set(10,20,10),s.castShadow=!0,s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048,s.shadow.camera.near=.5,s.shadow.camera.far=50,s.shadow.camera.left=-15,s.shadow.camera.right=15,s.shadow.camera.top=15,s.shadow.camera.bottom=-15,this.scene.add(s)}spawnLevelEnemies(e){const s=P.find(r=>r.number===e)||P[0],t=[],i=Math.ceil(s.enemyCount*.5);for(let r=0;r<i;r++)t.push({x:v-2-r%2*2,y:T-2-Math.floor(r/2)*2,type:"balloon"});const o=Math.ceil(s.enemyCount*.3);for(let r=0;r<o;r++)t.push({x:Math.floor(v/2)+r%2*2,y:Math.floor(T/2)+Math.floor(r/2)*2,type:"onion"});const n=s.enemyCount-i-o;for(let r=0;r<n;r++)t.push({x:Math.floor(v/2),y:Math.floor(T/2)+r,type:"tiger"});this.enemySpawner.spawnEnemiesAtPositions(t,s.enemySpeed)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}animate(){this.animationId=requestAnimationFrame(this.animate.bind(this));const e=performance.now(),s=Math.min((e-this.lastTime)/1e3,.1);this.lastTime=e,!this.gameOver&&!this.levelComplete&&this.update(s),this.renderer.render(this.scene,this.camera)}update(e){this.player.update(e,this.grid,this.input),this.input.consumeBomb()&&this.player.bombsAvailable>0&&this.placeBomb(),this.updateBombs(e),this.updateExplosions(e),this.activeBombPositions=this.bombs.map(s=>({x:s.x,y:s.y})),this.enemySpawner.update(e,this.player.gridX,this.player.gridY,this.activeBombPositions),this.processEnemyDrops(),this.checkGameConditions(),this.updateCamera()}placeBomb(){const e=this.grid.getCell(this.player.gridX,this.player.gridY);if(!e||e.hasBomb)return;e.hasBomb=!0,this.player.bombsAvailable--;const s=this.grid.gridToWorld(this.player.gridX,this.player.gridY),t=new d(this.bombGeo,this.bombMat);t.position.set(s.x,.3,s.z),t.castShadow=!0,this.scene.add(t),this.bombs.push({x:this.player.gridX,y:this.player.gridY,placedAt:performance.now(),range:this.player.explosionRange,mesh:t}),console.log(`ðŸ’£ Bomb placed at (${this.player.gridX}, ${this.player.gridY})`)}updateBombs(e){const s=performance.now();for(let t=this.bombs.length-1;t>=0;t--){const i=this.bombs[t],o=(s-i.placedAt)/1e3,n=1+Math.sin(o*10)*.1;i.mesh.scale.set(n,n,n),o>=N&&(this.explodeBomb(i),this.bombs.splice(t,1))}}explodeBomb(e){const s=this.grid.getCell(e.x,e.y);s&&(s.hasBomb=!1),this.player.returnBomb(),this.scene.remove(e.mesh),this.createExplosion(e.x,e.y);const t=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];for(const i of t)for(let o=1;o<=e.range;o++){const n=e.x+i.x*o,r=e.y+i.y*o,a=this.grid.getCell(n,r);if(!a||(this.createExplosion(n,r),a.type==="indestructible"))break;if(a.hasDestructibleWall){this.grid.destroyWall(n,r);break}this.player.gridX===n&&this.player.gridY===r&&this.player.alive&&(this.player.takeDamage(),this.player.alive||console.log("ðŸ’€ Player died!")),this.enemySpawner.checkExplosionHit(n,r);const h=this.bombs.find(m=>m.x===n&&m.y===r);if(h){h.placedAt=0;break}}console.log(`ðŸ’¥ Explosion at (${e.x}, ${e.y})`)}createExplosion(e,s){const t=this.grid.gridToWorld(e,s),i=new d(this.explosionGeo,this.explosionMat.clone());i.position.set(t.x,.05,t.z),this.scene.add(i),this.explosions.push({x:e,y:s,timeLeft:.5,mesh:i})}updateExplosions(e){for(let s=this.explosions.length-1;s>=0;s--){const t=this.explosions[s];t.timeLeft-=e;const i=t.timeLeft/.5;t.mesh.material.opacity=i,t.mesh.material.transparent=!0,t.timeLeft<=0&&(this.scene.remove(t.mesh),this.explosions.splice(s,1))}}processEnemyDrops(){const e=this.enemySpawner.consumePowerUpDrops();for(const s of e){const t=this.grid.getCell(s.x,s.y);if(t&&!t.powerUp){t.powerUp=s.type;const i={bomb:16728193,fire:16750592,speed:58998},o=this.grid.gridToWorld(s.x,s.y),n=new g(.25,8,8),r=new y({color:i[s.type],emissive:i[s.type],emissiveIntensity:.5}),a=new d(n,r);a.position.set(o.x,.3,o.z),this.grid.group.add(a),t.powerUpMesh=a,console.log(`ðŸŽ Enemy dropped ${s.type} power-up at (${s.x}, ${s.y})`)}}}checkGameConditions(){this.enemySpawner.areAllDefeated()&&(this.levelComplete=!0,console.log("ðŸŽ‰ Level Complete!")),this.player.alive||(this.gameOver=!0,console.log("ðŸ’€ Game Over!"))}updateCamera(){const e=this.player.worldX*.3,s=this.player.worldZ*.3+15;this.camera.position.x+=(e-this.camera.position.x)*.1,this.camera.position.z+=(s-this.camera.position.z)*.1,this.camera.lookAt(this.player.worldX*.2,0,this.player.worldZ*.2)}dispose(){this.animationId!==null&&cancelAnimationFrame(this.animationId),this.enemySpawner.reset(),this.renderer.dispose(),window.removeEventListener("resize",this.onWindowResize.bind(this))}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new G):new G;
