import{M as p,B as b,S as E,O as U,a as R,C as G,P as L,W as C,b as D,A as I,D as j,c as F,d as w,I as k}from"./three-D6A4gSIQ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const a=16,g=1,S=60,y=1/S;var d=(t=>(t[t.Floor=0]="Floor",t[t.HardBlock=1]="HardBlock",t[t.SoftBlock=2]="SoftBlock",t))(d||{}),h=(t=>(t[t.None=0]="None",t[t.Up=1]="Up",t[t.Down=2]="Down",t[t.Left=3]="Left",t[t.Right=4]="Right",t))(h||{}),f=(t=>(t.BombRange="bomb_range",t.BombCount="bomb_count",t.Speed="speed",t.FuseCharge="fuse_charge",t))(f||{});class K{constructor(s,o){this.onUpdate=s,this.onRender=o}accumulator=0;tick=0;lastTime=0;rafId=0;running=!1;frameCount=0;fpsAccum=0;fps=0;start(){this.running||(this.running=!0,this.lastTime=performance.now(),this.rafId=requestAnimationFrame(s=>this.loop(s)))}stop(){this.running=!1,cancelAnimationFrame(this.rafId)}loop(s){if(!this.running)return;const o=Math.min((s-this.lastTime)/1e3,.25);for(this.lastTime=s,this.accumulator+=o,this.fpsAccum+=o,this.frameCount++,this.fpsAccum>=1&&(this.fps=this.frameCount,this.frameCount=0,this.fpsAccum-=1);this.accumulator>=y;)this.onUpdate(y,this.tick),this.tick++,this.accumulator-=y;const e=this.accumulator/y;this.onRender(e),this.rafId=requestAnimationFrame(r=>this.loop(r))}getTick(){return this.tick}getSimRate(){return S}}function W(){const t=H(),s=[$(0,{col:1,row:1})];return{tick:0,grid:t,players:s,bombs:[],explosions:[],powerUps:[]}}function H(){const t=[];for(let o=0;o<a;o++){t[o]=[];for(let e=0;e<a;e++)o===0||o===a-1||e===0||e===a-1||o%2===0&&e%2===0?t[o][e]=d.HardBlock:t[o][e]=d.Floor}const s=new Set(["1,1","1,2","2,1",`${a-2},${a-2}`,`${a-2},${a-3}`,`${a-3},${a-2}`,`1,${a-2}`,`1,${a-3}`,`2,${a-2}`,`${a-2},1`,`${a-3},1`,`${a-2},2`]);for(let o=1;o<a-1;o++)for(let e=1;e<a-1;e++)t[o][e]===d.Floor&&!s.has(`${e},${o}`)&&Math.random()<.4&&(t[o][e]=d.SoftBlock);return t}function $(t,s){return{id:t,gridPos:{...s},worldPos:{x:s.col,y:s.row},moveDir:h.None,speed:3.5,bombRange:2,maxBombs:1,activeBombs:0,fuseCharges:3,alive:!0}}class O{keys=new Set;justPressed=new Set;gamepadIndex=null;pauseCallback=null;constructor(){this.setupEventListeners()}setupEventListeners(){window.addEventListener("keydown",s=>{["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.code)&&s.preventDefault(),this.keys.has(s.code)||(this.justPressed.add(s.code),(s.code==="KeyP"||s.code==="Escape")&&this.pauseCallback?.()),this.keys.add(s.code)}),window.addEventListener("keyup",s=>{this.keys.delete(s.code)}),window.addEventListener("gamepadconnected",s=>{this.gamepadIndex=s.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{this.gamepadIndex=null})}setPauseCallback(s){this.pauseCallback=s}poll(){const s={moveDir:this.getMoveDirection(),placeBomb:this.justPressed.has("Space"),fuseAction:this.getFuseAction(),pause:this.justPressed.has("KeyP")||this.justPressed.has("Escape"),menuBack:this.justPressed.has("Escape")||this.justPressed.has("Backspace"),menuSelect:this.justPressed.has("Enter")||this.justPressed.has("Space"),menuUp:this.justPressed.has("ArrowUp")||this.justPressed.has("KeyW"),menuDown:this.justPressed.has("ArrowDown")||this.justPressed.has("KeyS"),menuLeft:this.justPressed.has("ArrowLeft")||this.justPressed.has("KeyA"),menuRight:this.justPressed.has("ArrowRight")||this.justPressed.has("KeyD")};if(this.gamepadIndex!==null){const o=navigator.getGamepads()[this.gamepadIndex];if(o){const[e,r]=[o.axes[0],o.axes[1]],i=.3;s.moveDir===h.None&&(r<-i?s.moveDir=h.Up:r>i?s.moveDir=h.Down:e<-i?s.moveDir=h.Left:e>i&&(s.moveDir=h.Right)),o.buttons[0]?.pressed&&(s.placeBomb=!0),o.buttons[1]?.pressed&&(s.fuseAction="rush"),o.buttons[2]?.pressed&&(s.fuseAction="prime"),o.buttons[3]?.pressed&&(s.fuseAction="detonate"),o.buttons[9]?.pressed&&(s.pause=!0),o.buttons[8]?.pressed&&(s.menuBack=!0),o.buttons[12]?.pressed&&(s.menuUp=!0),o.buttons[13]?.pressed&&(s.menuDown=!0),o.buttons[14]?.pressed&&(s.menuLeft=!0),o.buttons[15]?.pressed&&(s.menuRight=!0)}}return this.justPressed.clear(),s}getMoveDirection(){return this.keys.has("KeyW")||this.keys.has("ArrowUp")?h.Up:this.keys.has("KeyS")||this.keys.has("ArrowDown")?h.Down:this.keys.has("KeyA")||this.keys.has("ArrowLeft")?h.Left:this.keys.has("KeyD")||this.keys.has("ArrowRight")?h.Right:h.None}getFuseAction(){return this.justPressed.has("KeyQ")?"prime":this.justPressed.has("KeyE")?"rush":this.justPressed.has("KeyR")?"detonate":null}pollMenuNav(){return{up:this.keys.has("ArrowUp")||this.keys.has("KeyW"),down:this.keys.has("ArrowDown")||this.keys.has("KeyS"),left:this.keys.has("ArrowLeft")||this.keys.has("KeyA"),right:this.keys.has("ArrowRight")||this.keys.has("KeyD")}}isKeyHeld(s){return this.keys.has(s)}}class P{scene;camera;renderer;floorMesh;hardBlockPool;softBlockPool;playerMeshes=[];bombMeshes=new Map;explosionMeshes=[];powerUpMeshes=[];matFloor=new p({color:2763306});matHard=new p({color:5592405});matSoft=new p({color:9136404});matPlayer=new p({color:43775});matBomb=new p({color:1118481});matBombPrimed=new p({color:3359999,emissive:1122986});matBombRushed=new p({color:16720418,emissive:11145489});matExplosion=new p({color:16737792,emissive:16729088,transparent:!0,opacity:.85});matPowerUp=new p({color:4521796,emissive:2271778});geoBlock=new b(g*.95,g*.95,g*.95);geoPlayer=new b(.7,.9,.7);geoBomb=new E(.35,16,16);geoExplosion=new b(g*.9,.3,g*.9);geoPowerUp=new b(.4,.4,.4);dummy=new U;constructor(){this.scene=new R,this.scene.background=new G(657930);const s=(a-1)/2;this.camera=new L(50,window.innerWidth/window.innerHeight,.1,100),this.camera.position.set(s,18,s+12),this.camera.lookAt(s,0,s);try{this.renderer=new C({antialias:!0})}catch(c){throw P.showWebGLError(),new Error("WebGL initialization failed: "+(c instanceof Error?c.message:String(c)))}this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=D,document.body.appendChild(this.renderer.domElement);const o=new I(16777215,.4);this.scene.add(o);const e=new j(16777215,.8);e.position.set(s+5,15,s-5),e.castShadow=!0,e.shadow.mapSize.set(1024,1024),e.shadow.camera.near=1,e.shadow.camera.far=40;const r=a;e.shadow.camera.left=-r,e.shadow.camera.right=r,e.shadow.camera.top=r,e.shadow.camera.bottom=-r,this.scene.add(e);const i=new F(a,a);this.floorMesh=new w(i,this.matFloor),this.floorMesh.rotation.x=-Math.PI/2,this.floorMesh.position.set(s,-.01,s),this.floorMesh.receiveShadow=!0,this.scene.add(this.floorMesh);const n=a*a;this.hardBlockPool=new k(this.geoBlock,this.matHard,n),this.hardBlockPool.castShadow=!0,this.hardBlockPool.receiveShadow=!0,this.scene.add(this.hardBlockPool),this.softBlockPool=new k(this.geoBlock,this.matSoft,n),this.softBlockPool.castShadow=!0,this.softBlockPool.receiveShadow=!0,this.scene.add(this.softBlockPool),window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})}syncState(s,o){let e=0,r=0;for(let i=0;i<a;i++)for(let n=0;n<a;n++){const c=s.grid[i][n];c===d.HardBlock?(this.dummy.position.set(n,.475,i),this.dummy.updateMatrix(),this.hardBlockPool.setMatrixAt(e++,this.dummy.matrix)):c===d.SoftBlock&&(this.dummy.position.set(n,.475,i),this.dummy.updateMatrix(),this.softBlockPool.setMatrixAt(r++,this.dummy.matrix))}this.hardBlockPool.count=e,this.hardBlockPool.instanceMatrix.needsUpdate=!0,this.softBlockPool.count=r,this.softBlockPool.instanceMatrix.needsUpdate=!0,this.syncPlayers(s),this.syncBombs(s),this.syncExplosions(s),this.syncPowerUps(s)}syncPlayers(s){for(;this.playerMeshes.length<s.players.length;){const o=new w(this.geoPlayer,this.matPlayer);o.castShadow=!0,this.scene.add(o),this.playerMeshes.push(o)}for(let o=0;o<this.playerMeshes.length;o++){const e=this.playerMeshes[o];o<s.players.length&&s.players[o].alive?(e.visible=!0,e.position.set(s.players[o].worldPos.x,.45,s.players[o].worldPos.y)):e.visible=!1}}syncBombs(s){const o=new Set(s.bombs.map(e=>e.id));for(const[e,r]of this.bombMeshes)o.has(e)||(this.scene.remove(r),this.bombMeshes.delete(e));for(const e of s.bombs){let r=this.bombMeshes.get(e.id);if(!r){const n=e.primed?this.matBombPrimed:e.rushed?this.matBombRushed:this.matBomb;r=new w(this.geoBomb,n),r.castShadow=!0,this.scene.add(r),this.bombMeshes.set(e.id,r)}r.position.set(e.gridPos.col,.35,e.gridPos.row);const i=1+.05*Math.sin(Date.now()*.01*(e.rushed?4:e.primed?1:2));r.scale.setScalar(i)}}syncExplosions(s){for(;this.explosionMeshes.length>s.explosions.length;){const o=this.explosionMeshes.pop();this.scene.remove(o)}for(let o=0;o<s.explosions.length;o++){let e=this.explosionMeshes[o];e||(e=new w(this.geoExplosion,this.matExplosion.clone()),e.castShadow=!1,this.scene.add(e),this.explosionMeshes.push(e));const r=s.explosions[o];e.position.set(r.gridPos.col,.15,r.gridPos.row),e.material.opacity=Math.min(1,r.remaining*2)}}syncPowerUps(s){for(;this.powerUpMeshes.length>s.powerUps.length;){const o=this.powerUpMeshes.pop();this.scene.remove(o)}for(let o=0;o<s.powerUps.length;o++){let e=this.powerUpMeshes[o];e||(e=new w(this.geoPowerUp,this.matPowerUp),this.scene.add(e),this.powerUpMeshes.push(e));const r=s.powerUps[o];e.position.set(r.gridPos.col,.3+.1*Math.sin(Date.now()*.003),r.gridPos.row),e.rotation.y+=.02}}render(){this.renderer.render(this.scene,this.camera)}static showWebGLError(){const s=document.createElement("div");s.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      color: #ff4444;
      padding: 30px;
      border-radius: 12px;
      font-family: Arial, sans-serif;
      max-width: 500px;
      text-align: center;
      z-index: 10000;
      border: 2px solid #ff4444;
    `,s.innerHTML=`
      <h2 style="margin: 0 0 15px 0; color: #ff6666;">WebGL Not Supported</h2>
      <p style="margin: 0 0 15px 0; line-height: 1.6;">
        This game requires WebGL to run, but your browser or device doesn't support it.
      </p>
      <p style="margin: 0; font-size: 14px; color: #aaa;">
        Try updating your browser or enabling hardware acceleration in settings.
      </p>
    `,document.body.appendChild(s)}}class N{ctx=null;masterGain;musicGain;sfxGain;uiGain;constructor(){}ensureContext(){return this.ctx||(this.ctx=new AudioContext,this.masterGain=this.ctx.createGain(),this.musicGain=this.ctx.createGain(),this.sfxGain=this.ctx.createGain(),this.uiGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain.connect(this.masterGain),this.uiGain.connect(this.masterGain),this.masterGain.connect(this.ctx.destination)),this.ctx.state==="suspended"&&this.ctx.resume(),this.ctx}setMusicVolume(s){this.ensureContext(),this.musicGain.gain.value=s}setSfxVolume(s){this.ensureContext(),this.sfxGain.gain.value=s}setUiVolume(s){this.ensureContext(),this.uiGain.gain.value=s}playSfx(s=440,o=.1){const e=this.ensureContext(),r=e.createOscillator();r.frequency.value=s,r.type="square",r.connect(this.sfxGain),r.start(),r.stop(e.currentTime+o)}playExplosion(){this.playSfx(80,.3)}playBombPlace(){this.playSfx(200,.05)}playPowerUp(){this.playSfx(880,.15)}}function _(t,s){return s.col<0||s.col>=a||s.row<0||s.row>=a?!1:t[s.row][s.col]===d.Floor}function B(t){return{col:Math.round(t.x),row:Math.round(t.y)}}function z(t){switch(t){case h.Up:return{x:0,y:-1};case h.Down:return{x:0,y:1};case h.Left:return{x:-1,y:0};case h.Right:return{x:1,y:0};default:return{x:0,y:0}}}function q(t,s,o){const e=t.players[s];if(!e||!e.alive||e.moveDir===h.None)return;const r=z(e.moveDir),i=e.worldPos.x+r.x*e.speed*o,n=e.worldPos.y+r.y*e.speed*o,c=B({x:i,y:n});_(t.grid,c)&&!T(t,c,e.id)&&(e.worldPos.x=i,e.worldPos.y=n,e.gridPos=B(e.worldPos))}function T(t,s,o){return t.bombs.some(e=>e.gridPos.col===s.col&&e.gridPos.row===s.row)}let V=1;const Q=3,Z=5,X=1.5;function J(t,s){const o=t.players[s];if(!o||!o.alive||o.activeBombs>=o.maxBombs||t.bombs.some(r=>r.gridPos.col===o.gridPos.col&&r.gridPos.row===o.gridPos.row))return!1;const e={id:V++,gridPos:{...o.gridPos},ownerId:s,fuseRemaining:Q,range:o.bombRange,primed:!1,rushed:!1};return t.bombs.push(e),o.activeBombs++,!0}function Y(t,s){const o=[];for(let e=t.bombs.length-1;e>=0;e--)if(t.bombs[e].fuseRemaining-=s,t.bombs[e].fuseRemaining<=0){o.push({...t.bombs[e].gridPos});const r=t.players[t.bombs[e].ownerId];r&&r.activeBombs--,t.bombs.splice(e,1)}return o}function ee(t,s){const o=t.players[s];if(!o||o.fuseCharges<=0)return!1;const e=t.bombs.find(r=>r.ownerId===s&&!r.primed);return e?(e.fuseRemaining=Z,e.primed=!0,o.fuseCharges--,!0):!1}function se(t,s){const o=t.players[s];if(!o||o.fuseCharges<=0)return!1;const e=t.bombs.find(r=>r.ownerId===s&&!r.rushed);return e?(e.fuseRemaining=Math.min(e.fuseRemaining,X),e.rushed=!0,o.fuseCharges--,!0):!1}function oe(t,s){const o=t.players[s];if(!o||o.fuseCharges<=0)return null;const e=t.bombs.findIndex(n=>n.ownerId===s);if(e===-1)return null;const i={...t.bombs[e].gridPos};return t.bombs.splice(e,1),o.activeBombs--,o.fuseCharges--,i}const te=.5;function M(t,s,o){const e=[{pos:s,range:o}];for(;e.length>0;){const r=e.shift(),i=re(t,r.pos,r.range);for(const n of i){t.grid[n.row][n.col]===d.SoftBlock&&(t.grid[n.row][n.col]=d.Floor,ne(t,n)),t.explosions.push({gridPos:n,remaining:te});for(const c of t.players)c.alive&&c.gridPos.col===n.col&&c.gridPos.row===n.row&&(c.alive=!1);for(let c=t.bombs.length-1;c>=0;c--){const u=t.bombs[c];if(u.gridPos.col===n.col&&u.gridPos.row===n.row){t.bombs.splice(c,1);const m=t.players[u.ownerId];m&&m.activeBombs>0&&m.activeBombs--,e.push({pos:u.gridPos,range:u.range})}}}}}function re(t,s,o){const e=[{...s}],r=[{dc:0,dr:-1},{dc:0,dr:1},{dc:-1,dr:0},{dc:1,dr:0}];for(const{dc:i,dr:n}of r)for(let c=1;c<=o;c++){const u=s.col+i*c,m=s.row+n*c;if(u<0||u>=a||m<0||m>=a||t.grid[m][u]===d.HardBlock||(e.push({col:u,row:m}),t.grid[m][u]===d.SoftBlock))break}return e}function ie(t,s){for(let o=t.explosions.length-1;o>=0;o--)t.explosions[o].remaining-=s,t.explosions[o].remaining<=0&&t.explosions.splice(o,1)}function ne(t,s){if(Math.random()>.3)return;const o=[f.BombRange,f.BombCount,f.Speed,f.FuseCharge],e=o[Math.floor(Math.random()*o.length)];t.powerUps.push({gridPos:{...s},type:e})}function ae(t){let s=!1;for(const o of t.players)if(o.alive)for(let e=t.powerUps.length-1;e>=0;e--){const r=t.powerUps[e];r.gridPos.col===o.gridPos.col&&r.gridPos.row===o.gridPos.row&&(ce(t,o.id,r.type),t.powerUps.splice(e,1),s=!0)}return s}function ce(t,s,o){const e=t.players[s];if(e)switch(o){case f.BombRange:e.bombRange=Math.min(e.bombRange+1,8);break;case f.BombCount:e.maxBombs=Math.min(e.maxBombs+1,8);break;case f.Speed:e.speed=Math.min(e.speed+.5,6);break;case f.FuseCharge:e.fuseCharges=Math.min(e.fuseCharges+1,5);break}}const l=W(),he=new O,v=new P,x=new N,le=document.getElementById("fps-counter");function de(t,s){l.tick=s;const o=he.poll(),e=l.players[0];if(e?.alive){if(e.moveDir=o.moveDir,q(l,0,t),o.placeBomb&&J(l,0)&&x.playBombPlace(),o.fuseAction==="prime")ee(l,0);else if(o.fuseAction==="rush")se(l,0);else if(o.fuseAction==="detonate"){const i=oe(l,0);i&&(M(l,i,e.bombRange),x.playExplosion())}}const r=Y(l,t);for(const i of r)M(l,i,l.players[0]?.bombRange??2),x.playExplosion();ie(l,t),ae(l)}function ue(t){v.syncState(l,t),v.render(),le.textContent=`${A.fps} FPS`}const A=new K(de,ue);A.start();
